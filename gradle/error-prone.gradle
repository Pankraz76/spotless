import static java.lang.System.getenv

apply plugin: 'net.ltgt.errorprone'

dependencies {
	errorprone('com.google.errorprone:error_prone_core:2.42.0')
	errorprone('tech.picnic.error-prone-support:error-prone-contrib:0.25.0')
}

tasks.withType(JavaCompile).configureEach {
	options.errorprone {
		disable( // consider fix, or reasoning.
				'FunctionalInterfaceMethodChanged',
				'JavaxInjectOnAbstractMethod',
				'OverridesJavaxInjectableMethod',
				)
		error(
				'AmbiguousJsonCreator',
				'AssertJNullnessAssertion',
				'AutowiredConstructor',
				'CanonicalAnnotationSyntax',
				'CollectorMutability',
				'ConstantNaming',
				'DirectReturn',
				'EmptyMethod',
				'ExplicitArgumentEnumeration',
				'ExplicitEnumOrdering',
				'IdentityConversion',
				'ImmutablesSortedSetComparator',
				'IsInstanceLambdaUsage',
				'MockitoMockClassReference',
				'MockitoStubbing',
				'NestedOptionals',
				'PrimitiveComparison',
				'RedundantStringConversion',
				'RedundantStringEscape',
				'ReturnValueIgnored',
				'SelfAssignment',
				'StringJoin',
				'StringJoining',
				'UnnecessarilyFullyQualified',
				'UnnecessaryAssignment',
				'UnnecessaryBoxedAssignment',
				'UnnecessaryBoxedVariable',
				'UnnecessaryBreakInSwitch',
				'UnnecessaryCheckNotNull',
				'UnnecessaryCopy',
				'UnnecessaryDefaultInEnumSwitch',
				'UnnecessaryFinal',
				'UnnecessaryLambda',
				'UnnecessaryLongToIntConversion',
				'UnnecessaryMethodInvocationMatcher',
				'UnnecessaryMethodReference',
				'UnnecessaryParentheses',
				'UnnecessaryQualifier',
				'UnnecessarySetDefault',
				'UnnecessaryStaticImport',
				'UnnecessaryStringBuilder',
				'UnnecessaryTestMethodPrefix',
				'UnnecessaryTypeArgument',
				'UnusedVariable',
				'WildcardImport',
				)
		// bug: this only happens when the file is dirty.
		// might be an up2date (caching) issue, as file is currently in corrupt state.
		// ForbidGradleInternal(import org.gradle.api.internal.project.ProjectInternal;)
		errorproneArgs.add('-XepExcludedPaths:' +
				'.*/SelfTest.java|' +
				'.*/GradleIntegrationHarness.java'
				)
		if (!getenv().containsKey('CI') && getenv('IN_PLACE')?.toBoolean()) {
			errorproneArgs.addAll(
					'-XepPatchLocation:IN_PLACE',
					// remove XepPatchChecks once conform.
					'-XepPatchChecks:' +
					'UnnecessaryFinal'
					)
		}
	}
}
